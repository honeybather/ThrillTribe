{% extends 'base.html' %}
{% block title %}All Events{% endblock %}

{% block body %}
  <h1>All Events</h1>
  <ul>
    {% for event in events %}
     <li>
      <h2>{{ event.title }}</h2>
      <p>{{ event.description }}</p>
      <p>Date: {{ event.date_time.strftime('%Y-%m-%d %H:%M') }}</p>
      <p>Location: {{ event.location }}</p>
      <p>Cost: ${{ event.cost }}</p>
      {% if user_id == event.user_id %} 
        <p><strong>This is your event!</strong></p>
        {% else %}
        <button onclick="joinEvent('{{ event.id  }}')">Join</button>
      {% endif %}  
     </li>
    {% else %}
     <li>No events found</li>
    {% endfor %}
  </ul>

  <script>
  function joinEvent(eventId) {
    // implement the join event functionality
    console.log('Joining event with ID:', eventId);
    fetch('/join_event/${eventId}', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ user_id: '{{ user_id }}'}),
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('You have successfully joined the event!');
      } else {
        alert('Failed to join the event.' + data.message);
      }
    })
    .catch((error) => {
      console.error('Error:', error);
      alert('An error occurred while joining the event.');
    });
  }
  </script>
{% endblock %}